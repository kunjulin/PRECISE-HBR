# UI 修改可视化指南

## 📋 修改 1: 隐藏 Base Score

### 修改前 ❌
```
┌─────────────────────────────────────────────────────────┐
│ 📊 Score Components                                     │
├─────────────────────────────────────────────────────────┤
│ Risk Factor              │ Value (Editable) │ Score    │
├─────────────────────────────────────────────────────────┤
│ Base Score (fixed)       │ Fixed base score │   2      │  ← 这一行会被隐藏
│ Age (truncated...)       │ [98] years       │  13      │
│ Hemoglobin (truncated..) │ [12] g/dL        │   8      │
│ eGFR (truncated...)      │ [35] mL/min...   │   3      │
│ White Blood Cell Count   │ [8.5] ×10⁹/L     │   4      │
│ Previous bleeding        │ ☑ Yes            │   7      │
│ Long-term OAC            │ ☑ Yes            │   5      │
│ Other ARC-HBR conditions │ ☐ No             │   0      │
└─────────────────────────────────────────────────────────┘
```

### 修改后 ✅
```
┌─────────────────────────────────────────────────────────┐
│ 📊 Score Components                                     │
├─────────────────────────────────────────────────────────┤
│ Risk Factor              │ Value (Editable) │ Score    │
├─────────────────────────────────────────────────────────┤
│ Age (truncated...)       │ [98] years       │  13      │
│ Hemoglobin (truncated..) │ [12] g/dL        │   8      │
│ eGFR (truncated...)      │ [35] mL/min...   │   3      │
│ White Blood Cell Count   │ [8.5] ×10⁹/L     │   4      │
│ Previous bleeding        │ ☑ Yes            │   7      │
│ Long-term OAC            │ ☑ Yes            │   5      │
│ Other ARC-HBR conditions │ ☐ No             │   0      │
└─────────────────────────────────────────────────────────┘

⚠️ 注意: Base Score (2分) 仍然会被计算到总分中，
         只是不在界面上显示。
```

---

## 🚨 修改 2: 数据完整性检查

### 场景 A: 完整数据 ✅

**病患数据**: Age ✓, Hemoglobin ✓, eGFR ✓, WBC ✓

```
┌─────────────────────────────────────────────────────┐
│ 📊 Total Risk Score                                 │
├─────────────────────────────────────────────────────┤
│                                                     │
│                      36                             │
│            Very HBR (score ≥27)                     │
│                                                     │
│  1-year risk of major bleeding: 12.30%             │
│  (Bleeding Academic Research Consortium            │
│   [BARC] type 3 or 5)                              │
│                                                     │
│  ✓ High Bleeding Risk Detected (PRECISE-HBR ≥23)  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 场景 B: 缺少关键数据 (Age) ❌

**病患数据**: Age ✗, Hemoglobin ✓, eGFR ✓, WBC ✓

```
┌─────────────────────────────────────────────────────┐
│ ⚠️ Error Calculating Risk                           │
├─────────────────────────────────────────────────────┤
│                                                     │
│  資訊不完整，無法計算出血風險                            │
│                                                     │
│  以下關鍵資料缺少：                                     │
│  • Age                                              │
│                                                     │
│  請確保病患的 Age（年齡）、Hemoglobin（血紅素）、         │
│  eGFR（腎絲球過濾率）和 White Blood Cell（白血球）      │
│  數據完整後再試。                                       │
│                                                     │
│  [ 🔄 Retry ]                                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 场景 C: 缺少多个关键数据 ❌

**病患数据**: Age ✗, Hemoglobin ✗, eGFR ✓, WBC ✓

```
┌─────────────────────────────────────────────────────┐
│ ⚠️ Error Calculating Risk                           │
├─────────────────────────────────────────────────────┤
│                                                     │
│  資訊不完整，無法計算出血風險                            │
│                                                     │
│  以下關鍵資料缺少：                                     │
│  • Age                                              │
│  • Hemoglobin                                       │
│                                                     │
│  請確保病患的 Age（年齡）、Hemoglobin（血紅素）、         │
│  eGFR（腎絲球過濾率）和 White Blood Cell（白血球）      │
│  數據完整後再試。                                       │
│                                                     │
│  [ 🔄 Retry ]                                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 场景 D: 只缺少非关键数据 ⚠️

**病患数据**: Age ✓, Hemoglobin ✓, eGFR ✓, WBC ✓  
**非关键数据**: Previous Bleeding ✗, Long-term OAC ✗

```
┌─────────────────────────────────────────────────────┐
│ 📊 Total Risk Score                                 │
├─────────────────────────────────────────────────────┤
│                                                     │
│                      22                             │
│            High Risk                                │
│                                                     │
│  Consider shorter DAPT duration (1-3 months)       │
│  or P2Y12 inhibitor monotherapy.                   │
│                                                     │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│ 📊 Score Components                                 │
├─────────────────────────────────────────────────────┤
│ ...                                                 │
│ Previous bleeding    │ [Enter value] ⚠️            │
│ Long-term OAC        │ [Enter value] ⚠️            │
│ ...                                                 │
└─────────────────────────────────────────────────────┘

✅ 仍然会显示分数，但会标记缺少的非关键数据
```

---

## 🔍 数据完整性检查逻辑

```
                ┌─────────────────┐
                │  Load Patient   │
                │      Data       │
                └────────┬────────┘
                         │
                         ▼
          ┌──────────────────────────────┐
          │  检查关键数据是否完整？        │
          │  • Age                       │
          │  • Hemoglobin               │
          │  • eGFR                     │
          │  • White Blood Cell         │
          └──────┬───────────────────┬───┘
                 │                   │
          所有存在✓                缺少至少1个✗
                 │                   │
                 ▼                   ▼
    ┌────────────────────┐  ┌────────────────────┐
    │  显示风险分数        │  │  显示错误信息        │
    │  + Score Components│  │  + 缺少的数据列表    │
    │  + 建议             │  │  + Retry 按钮       │
    └────────────────────┘  └────────────────────┘
```

---

## 📱 用户体验改进

### 改进点 1: 界面简洁
- ❌ 移除了对用户没有意义的 "Base Score (fixed): 2"
- ✅ 用户只看到可以理解和编辑的参数

### 改进点 2: 数据透明
- ❌ 以前：即使关键数据缺失，仍显示可能不准确的分数
- ✅ 现在：明确告知用户数据不完整，无法计算

### 改进点 3: 友好提示
- ✅ 使用中文错误信息
- ✅ 清楚列出缺少的具体数据项
- ✅ 提供重试机制

---

## 🧪 测试清单

- [ ] 测试场景 A：完整数据，应正常显示分数
- [ ] 测试场景 B：缺少 Age，应显示错误
- [ ] 测试场景 C：缺少多个关键数据，应显示错误
- [ ] 测试场景 D：只缺少非关键数据，应正常显示分数
- [ ] 验证 Base Score 不在界面显示
- [ ] 验证总分计算仍然包含 Base Score (2分)
- [ ] 测试手动编辑功能仍然正常
- [ ] 测试 CCD 导出功能正常
- [ ] 测试 Tradeoff Analysis 链接正常

---

## 📞 支持信息

如有问题，请检查：
1. 浏览器控制台是否有 JavaScript 错误
2. FHIR 数据是否成功获取
3. 数据格式是否符合预期

**修改文件**: `templates/main.html`  
**版本**: v1.0  
**日期**: 2024-10-17

