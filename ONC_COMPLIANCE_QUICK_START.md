# ONC 合規性快速指南

**應用程式：** SMART on FHIR PRECISE-HBR 計算器  
**文件日期：** 2025年10月2日  
**狀態：** 部分合規，正在實施中

---

## 📊 合規性概況

您的應用程式目前在 Epic 要求的 17 項 ONC 認證標準中：

```
✅ 完全符合：6 項 (35%)
⚠️ 部分符合：7 項 (41%)  
❌ 尚未符合：4 項 (24%)
```

**預估達成完全合規所需時間：5-7 週**

---

## ✅ 已完成項目

### 1. 身份驗證與存取控制 ✓
- **標準：** 45 CFR 170.315 (d)(1)
- **實施方式：** SMART on FHIR OAuth 2.0 授權流程
- **證明：** `auth.py`, `config.py`

### 2. 自動會話超時 ✓ *（剛剛完成！）*
- **標準：** 45 CFR 170.315 (d)(5)
- **實施方式：** 15分鐘不活動自動登出，1分鐘前顯示警告
- **證明：** `templates/main.html` (第636-777行), `APP.py` (第323-337行)

### 3. 加密傳輸 ✓
- **標準：** 45 CFR 170.315 (d)(9)
- **實施方式：** 所有通訊強制使用 HTTPS/TLS
- **證明：** `APP.py` (Flask-Talisman), `requirements.txt`

### 4. 資料完整性驗證 ✓
- **標準：** 45 CFR 170.315 (d)(8)
- **實施方式：** HTTPS 提供的 TLS 訊息完整性保護
- **證明：** 所有 API 通訊使用 HTTPS

### 5. 終端裝置加密 ✓ (不適用)
- **標準：** 45 CFR 170.315 (d)(7)
- **說明：** 網頁應用不在終端裝置儲存 ePHI
- **證明：** 應用程式架構分析

### 6. API 存取標準 ✓ (不適用)
- **標準：** 45 CFR 170.315 (g)(7), (g)(8), (g)(9)
- **說明：** 本應用是 API 消費者，不是提供者
- **證明：** 使用 `fhirclient` 函式庫消費 FHIR API

---

## 🔴 高優先級待辦項目

### 1. 審計日誌系統 （必須）
- **標準：** 45 CFR 170.315 (d)(2), (d)(3)
- **需求：** 記錄所有對 ePHI 的存取，包含使用者、時間、操作
- **預估工時：** 3-5 天
- **實施步驟：**
  1. 創建審計日誌資料模型
  2. 在所有 FHIR 資料存取點插入日誌記錄
  3. 實施防竄改機制（如：加密雜湊、只能附加的資料庫）
  4. 創建審計報告介面（查詢、篩選、匯出）

### 2. 投訴處理流程 （必須）
- **標準：** 45 CFR 170.523 (n)
- **需求：** 建立正式的使用者反饋與投訴機制
- **預估工時：** 1 天設置 + 持續維護
- **實施步驟：**
  1. 在 UI 中加入「回報問題」連結
  2. 設置投訴收集電子郵件或表單
  3. 創建投訴追蹤試算表或資料庫
  4. 建立每季向 ONC 報告的流程

---

## 🟡 中優先級待辦項目

### 3. CCD 資料匯出功能
- **標準：** 45 CFR 170.315 (b)(6)
- **需求：** 讓使用者能匯出風險評估結果為 CCD 格式
- **預估工時：** 5-7 天

### 4. 使用者中心設計文件
- **標準：** 45 CFR 170.315 (g)(3)
- **需求：** 記錄設計過程、使用者研究、可用性測試
- **預估工時：** 3-5 天

### 5. 無障礙設計
- **標準：** 45 CFR 170.315 (g)(5)
- **需求：** 符合 WCAG 2.1 AA 級標準
- **預估工時：** 3-5 天

### 6. 品質管理系統文件
- **標準：** 45 CFR 170.315 (g)(4)
- **需求：** 記錄軟體開發、測試、維護流程
- **預估工時：** 3-5 天

---

## 📁 重要文件位置

### 已完成的合規性文件
1. **[`onc_certification_compliance_assessment.md`](onc_certification_compliance_assessment.md)**  
   📄 17 項 ONC 標準的詳細評估報告（主要文件）

2. **[`compliance_documentation_index.md`](compliance_documentation_index.md)**  
   📚 所有合規性文件的索引和導覽

3. **[`risk_analysis_report.md`](risk_analysis_report.md)**  
   🔒 HIPAA 安全風險分析報告

4. **[`risk_management_plan.md`](risk_management_plan.md)**  
   🛡️ HIPAA 風險管理計畫

### 關鍵程式碼檔案
- `templates/main.html` - 包含自動會話超時功能
- `APP.py` - 主應用程式，包含 `/logout` 端點
- `config.py` - 安全配置（強制 SECRET_KEY）
- `fhir_data_service.py` - 資料擷取服務（已清理日誌）

---

## 🚀 建議實施路線圖

### 第 1 階段：關鍵安全功能（2-3 週）
- [ ] 實施審計日誌系統 (d)(2)
- [ ] 創建審計報告介面 (d)(3)
- [ ] 建立投訴處理流程 (n)

### 第 2 階段：臨床互操作性（2-3 週）
- [ ] 實施 CCD 匯出功能 (b)(6)
- [ ] 記錄使用者中心設計過程 (g)(3)
- [ ] 無障礙設計改進 (g)(5)

### 第 3 階段：文件與商業實踐（1-2 週）
- [ ] 品質管理系統文件 (g)(4)
- [ ] 價格透明化文件 (k)(1)
- [ ] 準備 Epic 提交的最終合規證據包

---

## 💡 立即可以做的事

### 選項 1：繼續自動化實施
如果您希望我繼續實施下一個功能，請告訴我您想優先處理：
1. **審計日誌系統** - 高優先級，技術性較強
2. **投訴處理流程** - 高優先級，較簡單
3. **無障礙設計改進** - 中優先級，可立即改善使用者體驗

### 選項 2：先測試已完成的功能
您可以先啟動應用程式，測試新實施的自動會話超時功能：
1. 啟動應用程式
2. 登入並存取主頁面
3. 等待 14 分鐘（或修改程式碼中的 `INACTIVITY_TIMEOUT` 變數為較短時間以便測試）
4. 應該會看到「Session Timeout Warning」警告視窗

### 選項 3：審閱文件
花時間仔細閱讀：
- `onc_certification_compliance_assessment.md` - 了解每個標準的詳細要求
- `compliance_documentation_index.md` - 了解整體文件結構

---

## ❓ 常見問題

### Q1: 我需要正式的 ONC 認證嗎？
**A:** 根據 Epic 的要求，您需要提供以下其中之一：
1. 您的應用已通過 ONC 認證的公開文件
2. 具備等效功能的公開文件（即使未正式認證）
3. 說明為何特定標準不適用於您應用的公開文件

大多數獨立開發者選擇選項 2 或 3。

### Q2: 這些文件需要公開嗎？
**A:** 是的。Epic 和社群成員需要能夠審查您的合規性文件。通常做法是：
1. 在 GitHub 儲存庫中包含這些文件
2. 在應用的「About」或「Documentation」頁面提供連結
3. 在提交給 Epic 審查時提供這些文件的連結

### Q3: 完成所有這些需要多少成本？
**A:** 主要成本是開發時間。根據您的團隊規模：
- **單人開發者：** 5-7 週全職工作
- **小團隊（2-3人）：** 2-3 週
- **外包開發：** 預估 USD $10,000 - $20,000（取決於地區和經驗）

### Q4: 如果我先上線，後續再補齊文件可以嗎？
**A:** 技術上可行，但**不建議**。原因：
1. Epic 或社群成員可能隨時審查您的應用
2. 如果發現不合規，您的應用可能被暫停
3. 補救措施會更昂貴且緊迫
4. 您對病患資料保護負有法律責任（HIPAA）

---

## 📞 需要協助？

如果您想繼續實施任何功能，只需告訴我：

**範例：**
- "請幫我實施審計日誌系統"
- "請幫我創建投訴處理流程"
- "我想先了解無障礙設計需要什麼"
- "幫我準備提交給 Epic 的文件"

我會立即開始工作！

---

**最後更新：** 2025年10月2日  
**下次建議審查：** 完成下一個高優先級項目後

