{% extends "layout.html" %}
{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">{{ title }} - Patient ID: {{ patient_id }}</h2>
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle mr-1"></i>
                            PRECISE-DAPT Bleeding Risk Assessment 5-item Model ({{ config_version or '2.1.0' }})
                        </p>
                    </div>
                    <div>
                        <a href="{{ url_for('main_app_page') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Main
                        </a>
                    </div>
                </div>

    {% if calculation_details and calculation_details.category %}
                    <!-- Risk Category Alert -->
                    <div class="alert alert-{% if 'High' in calculation_details.category %}danger{% elif 'Moderate' in calculation_details.category %}warning{% elif 'Low' in calculation_details.category and 'Very Low' not in calculation_details.category %}info{% else %}success{% endif %} shadow-sm" role="alert">
                        <div class="d-flex align-items-center">
                            <div class="mr-3">
                                {% if 'High' in calculation_details.category %}
                                    <i class="fas fa-exclamation-triangle fa-2x"></i>
                                {% elif 'Moderate' in calculation_details.category %}
                                    <i class="fas fa-exclamation-circle fa-2x"></i>
                                {% elif 'Low' in calculation_details.category and 'Very Low' not in calculation_details.category %}
                                    <i class="fas fa-info-circle fa-2x"></i>
                                {% else %}
                                    <i class="fas fa-check-circle fa-2x"></i>
                                {% endif %}
                            </div>
                            <div>
                                <h4 class="alert-heading mb-1">
                                    Bleeding Risk Level: 
                                    <span class="font-weight-bold text-uppercase">{{ calculation_details.category }}</span>
                                </h4>
                                <p class="mb-0">
                                    <strong>PRECISE-DAPT Score: {{ calculation_details.score }}</strong>
                                    {% if 'High' in calculation_details.category %}
                                        - <strong>Consider shorter DAPT duration (3-6 months)</strong>
                                    {% elif 'Moderate' in calculation_details.category %}
                                        - <strong>Standard DAPT duration with careful monitoring</strong>
                                    {% else %}
                                        - <strong>Standard DAPT duration (12 months) recommended</strong>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Left Column: Patient Demographics and Lab Values -->
                        <div class="col-lg-6 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-user-md mr-2"></i>Patient Data & PRECISE-DAPT Parameters
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th class="w-40">Patient ID:</th>
                                                <td>
                                                    <span class="badge badge-primary">
                                                        <i class="fas fa-id-card mr-1"></i>{{ patient_id }}
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Age:</th>
                                                <td>
                                                    <span class="badge badge-{% if calculation_details.score_details.age_score_component > 0 %}warning{% else %}secondary{% endif %}">
                                                        {{ calculation_details.age if calculation_details.age is not none else 'Unknown' }} years
                                                    </span>
                                                    {% if calculation_details.score_details.age_score_component > 0 %}
                                                        <small class="text-warning ml-2">
                                                            <i class="fas fa-plus-circle"></i> {{ calculation_details.score_details.age_score_component }} points
                                                        </small>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Gender:</th>
                                                <td>
                                                    <span class="badge badge-info">
                                                        {{ calculation_details.sex.title() if calculation_details.sex else 'Unknown' }}
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Hemoglobin (g/dL):</th>
                                                <td>
                                                    {% if calculation_details.hb_value is not none %}
                                                        <span class="badge badge-{% if calculation_details.score_details.hemoglobin_score_component > 0 %}warning{% else %}success{% endif %}">
                                                            {{ "%.1f" | format(calculation_details.hb_value) }}
                                                        </span>
                                                        {% if calculation_details.score_details.hemoglobin_score_component > 0 %}
                                                            <small class="text-warning ml-2">
                                                                <i class="fas fa-plus-circle"></i> {{ calculation_details.score_details.hemoglobin_score_component }} points
                                                            </small>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="badge badge-secondary">Not measured</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Creatinine Clearance (mL/min/1.73m²):</th>
                                                <td>
                                                    {% if calculation_details.ccr_value is not none %}
                                                        <span class="badge badge-{% if calculation_details.score_details.creatinine_clearance_score_component > 0 %}warning{% else %}success{% endif %}">
                                                            {{ "%.0f" | format(calculation_details.ccr_value) }}
                                                        </span>
                                                        {% if calculation_details.score_details.creatinine_clearance_score_component > 0 %}
                                                            <small class="text-warning ml-2">
                                                                <i class="fas fa-plus-circle"></i> {{ calculation_details.score_details.creatinine_clearance_score_component }} points
                                                            </small>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="badge badge-secondary">Not measured</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>White Blood Cell Count (×10⁹/L):</th>
                                                <td>
                                                    {% if calculation_details.wbc_value is not none %}
                                                        <span class="badge badge-{% if calculation_details.score_details.wbc_score_component > 0 %}warning{% else %}success{% endif %}">
                                                            {{ "%.1f" | format(calculation_details.wbc_value) }}
                                                        </span>
                                                        {% if calculation_details.score_details.wbc_score_component > 0 %}
                                                            <small class="text-warning ml-2">
                                                                <i class="fas fa-plus-circle"></i> {{ calculation_details.score_details.wbc_score_component }} points
                                                            </small>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="badge badge-secondary">Not measured</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Prior Bleeding History:</th>
                                                <td>
                                                    <span class="badge badge-{% if calculation_details.bleeding_history %}danger{% else %}success{% endif %}">
                                                        {% if calculation_details.bleeding_history %}Yes{% else %}No{% endif %}
                                                    </span>
                                                    {% if calculation_details.score_details.bleeding_history_score_component > 0 %}
                                                        <small class="text-danger ml-2">
                                                            <i class="fas fa-plus-circle"></i> {{ calculation_details.score_details.bleeding_history_score_component }} points
                                                        </small>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: PRECISE-DAPT Score Summary -->
                        <div class="col-lg-6 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-calculator mr-2"></i>PRECISE-DAPT Score Summary
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th class="w-60">Age Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if calculation_details.score_details.age_score_component > 0 %}warning{% else %}light{% endif %} badge-lg">
                                                        {{ calculation_details.score_details.age_score_component }} points
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Hemoglobin Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if calculation_details.score_details.hemoglobin_score_component > 0 %}warning{% else %}light{% endif %} badge-lg">
                                                        {{ calculation_details.score_details.hemoglobin_score_component }} points
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Creatinine Clearance Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if calculation_details.score_details.creatinine_clearance_score_component > 0 %}warning{% else %}light{% endif %} badge-lg">
                                                        {{ calculation_details.score_details.creatinine_clearance_score_component }} points
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>White Blood Cell Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if calculation_details.score_details.wbc_score_component > 0 %}warning{% else %}light{% endif %} badge-lg">
                                                        {{ calculation_details.score_details.wbc_score_component }} points
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Prior Bleeding Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if calculation_details.score_details.bleeding_history_score_component > 0 %}danger{% else %}light{% endif %} badge-lg">
                                                        {{ calculation_details.score_details.bleeding_history_score_component }} points
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr class="border-top">
                                                <th class="h5">Total Score:</th>
                                                <td class="text-right">
                                                    <span class="badge badge-{% if 'High' in calculation_details.category %}danger{% elif 'Moderate' in calculation_details.category %}warning{% else %}success{% endif %} badge-lg h5 mb-0">
                                                        {{ calculation_details.score }} points
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Risk Components Section -->
                    {% if risk_components %}
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-list-ul mr-2"></i>
                                    Detailed PRECISE-DAPT Components ({{ risk_components|length }})
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Value</th>
                                                <th>Score</th>
                                                <th>Date</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for component in risk_components %}
                                                <tr class="{% if component.score > 0 %}table-warning{% endif %}">
                                                    <td>
                                                        <strong>{% if component.parameter == 'PreciseDAPT - Age' %}Age{% elif component.parameter == 'PreciseDAPT - Hemoglobin' %}Hemoglobin{% elif component.parameter == 'PreciseDAPT - Creatinine Clearance' %}Creatinine Clearance{% elif component.parameter == 'PreciseDAPT - White Blood Cell Count' %}White Blood Cell Count{% elif component.parameter == 'PreciseDAPT - Prior Bleeding' %}Prior Bleeding History{% else %}{{ component.parameter }}{% endif %}</strong>
                                                    </td>
                                                    <td>{{ component.value }}</td>
                                                    <td>
                                                        <span class="badge badge-{% if component.score >= 15 %}danger{% elif component.score >= 5 %}warning{% elif component.score > 0 %}info{% else %}secondary{% endif %}">
                                                            {{ component.score }}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">{{ component.date }}</small>
                                                    </td>
                                                    <td>
                                                        <small class="text-muted">{{ component.description }}</small>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- High Risk Guideline Section -->
                    {% if 'High' in calculation_details.category %}
                        <div class="card shadow-sm mb-4 border-danger">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    High Bleeding Risk DAPT Management Guidelines
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning">
                                    <h6><i class="fas fa-info-circle mr-2"></i>Clinical Recommendations (PRECISE-DAPT ≥25):</h6>
                                    <ul class="mb-0">
                                        <li>Consider shorter DAPT duration (3-6 months)</li>
                                        <li>Close monitoring for bleeding events</li>
                                        <li>Evaluate use of proton pump inhibitors</li>
                                        <li>Regular hemoglobin and renal function checks</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    {% elif 'Moderate' in calculation_details.category %}
                        <div class="card shadow-sm mb-4 border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    Moderate Bleeding Risk DAPT Management
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle mr-2"></i>Clinical Recommendations (PRECISE-DAPT 16-24):</h6>
                                    <ul class="mb-0">
                                        <li>Standard DAPT duration (12 months)</li>
                                        <li>Regular monitoring of bleeding risk factors</li>
                                        <li>Consider individualized treatment strategy</li>
                                        <li>Consult cardiologist when necessary</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="card shadow-sm mb-4 border-success">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    Low Bleeding Risk DAPT Management
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-success">
                                    <h6><i class="fas fa-check-circle mr-2"></i>Clinical Recommendations (PRECISE-DAPT 0-15):</h6>
                                    <ul class="mb-0">
                                        <li>Standard DAPT duration (12 months) recommended</li>
                                        <li>Routine monitoring sufficient</li>
                                        <li>Assess extended therapy based on ischemic risk</li>
                                        <li>Follow guideline-recommended antiplatelet therapy</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- User Feedback Section -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <i class="fas fa-comment-dots mr-2"></i>
                                計算結果回饋 (Result Feedback)
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">您覺得這個出血風險計算結果準確嗎？請給我們您的回饋意見：</p>
                            <div id="feedbackSection">
                                <div class="d-flex justify-content-center mb-3">
                                    <button type="button" id="thumbsUpBtn" class="btn btn-outline-success btn-lg mx-2" 
                                            onclick="submitFeedback('thumbs_up')" title="計算結果準確">
                                        <i class="fas fa-thumbs-up mr-2"></i>
                                        準確 (讚)
                                    </button>
                                    <button type="button" id="thumbsDownBtn" class="btn btn-outline-danger btn-lg mx-2" 
                                            onclick="submitFeedback('thumbs_down')" title="計算結果不準確">
                                        <i class="fas fa-thumbs-down mr-2"></i>
                                        不準確 (倒讚)
                                    </button>
                                </div>
                                
                                <!-- Optional Comment Section (Initially Hidden) -->
                                <div id="commentSection" class="mt-3" style="display: none;">
                                    <div class="form-group">
                                        <label for="feedbackComment">
                                            <i class="fas fa-comment mr-1"></i>
                                            額外意見 (選填):
                                        </label>
                                        <textarea id="feedbackComment" class="form-control" rows="3" 
                                                  placeholder="請分享您對計算結果的具體意見或建議..."></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary mr-2" onclick="cancelFeedback()">
                                            取消
                                        </button>
                                        <button type="button" id="submitCommentBtn" class="btn btn-primary" onclick="submitComment()">
                                            <i class="fas fa-paper-plane mr-1"></i>
                                            提交回饋
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Feedback Success Message -->
                                <div id="feedbackSuccess" class="alert alert-success mt-3" style="display: none;">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span id="feedbackMessage">感謝您的回饋！</span>
                                </div>
                                
                                <!-- Feedback Error Message -->
                                <div id="feedbackError" class="alert alert-danger mt-3" style="display: none;">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    提交回饋時發生錯誤，請稍後再試。
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Details (Collapsible) -->
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <button class="btn btn-link btn-block text-left" type="button" 
                                    data-toggle="collapse" data-target="#technicalDetails" 
                                    aria-expanded="false" aria-controls="technicalDetails">
                                <i class="fas fa-cogs mr-2"></i>
                                Technical Calculation Details
                                <i class="fas fa-chevron-down float-right"></i>
                            </button>
                        </div>
                        <div id="technicalDetails" class="collapse">
                            <div class="card-body">
                                <h6>Configuration Version: {{ config_version or '1.2.0' }}</h6>
                                <h6>Scoring System: PRECISE-DAPT 2017</h6>
                                
                                <h6 class="mt-4">Score Details:</h6>
                                <pre class="bg-light p-3" style="max-height: 300px; overflow-y: auto;">{{ calculation_details.score_details | tojson(indent=2) }}</pre>
                                
                                {% if risk_components %}
                                <h6 class="mt-4">Complete Component List:</h6>
                                <pre class="bg-light p-3" style="max-height: 300px; overflow-y: auto;">{{ risk_components | tojson(indent=2) }}</pre>
                                {% endif %}
                            </div>
                        </div>
                    </div>

    {% else %}
                    <!-- Error State -->
                    <div class="alert alert-danger shadow-sm" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-exclamation-triangle fa-2x mr-3"></i>
                            <div>
                                <h4 class="alert-heading">Unable to Calculate or Display PRECISE-DAPT Score</h4>
                                <p class="mb-0">Please check if the data is complete or try again later.</p>
                            </div>
                        </div>
                    </div>
    {% endif %}

                <!-- Action Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <div>
                        <a href="{{ url_for('main_app_page') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Main App
                        </a>
                    </div>
                    <div>
                        <a href="{{ url_for('main_page') }}" class="btn btn-outline-info">
                            <i class="fas fa-tachometer-alt mr-2"></i>Simple Interface
                        </a>
                        <a href="{{ url_for('launch_cerner_sandbox') }}" class="btn btn-outline-primary ml-2">
                            <i class="fas fa-vial mr-2"></i>Cerner Sandbox Test
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

<!-- Pass template data to JavaScript -->
<script type="application/json" id="pageData">
{
    "patient_id": "{{ patient_id }}",
    "score": {% if calculation_details and calculation_details.score is not none %}{{ calculation_details.score }}{% else %}null{% endif %},
    "risk_level": "{% if calculation_details and calculation_details.category %}{{ calculation_details.category }}{% endif %}"
}
</script>

{% block scripts %}
<script>
// Add some interactive features for PRECISE-DAPT
document.addEventListener('DOMContentLoaded', function() {
    // Highlight components with scores
    const scoredRows = document.querySelectorAll('tr.table-warning');
    scoredRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#fff3cd';
            this.style.transform = 'scale(1.02)';
            this.style.transition = 'all 0.2s';
        });
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
            this.style.transform = '';
        });
    });
    
    // Add tooltips for score ranges
    const scoreElements = document.querySelectorAll('.badge');
    scoreElements.forEach(badge => {
        if (badge.textContent.includes('分')) {
            badge.setAttribute('title', 'PRECISE-DAPT 評分系統: 0-100分');
        }
    });
});

// Global feedback state
let currentFeedbackType = null;
let pageData = JSON.parse(document.getElementById('pageData').textContent);

// Submit feedback function
function submitFeedback(feedbackType) {
    currentFeedbackType = feedbackType;
    
    // Show comment section for additional feedback
    document.getElementById('commentSection').style.display = 'block';
    
    // Update button states
    document.getElementById('thumbsUpBtn').disabled = true;
    document.getElementById('thumbsDownBtn').disabled = true;
    
    // Highlight selected button
    if (feedbackType === 'thumbs_up') {
        document.getElementById('thumbsUpBtn').classList.remove('btn-outline-success');
        document.getElementById('thumbsUpBtn').classList.add('btn-success');
    } else {
        document.getElementById('thumbsDownBtn').classList.remove('btn-outline-danger');
        document.getElementById('thumbsDownBtn').classList.add('btn-danger');
    }
}

// Submit comment and feedback
function submitComment() {
    const comment = document.getElementById('feedbackComment').value;
    
    // Prepare feedback data using pageData
    const feedbackData = {
        patient_id: pageData.patient_id,
        feedback_type: currentFeedbackType,
        comment: comment,
        score: pageData.score,
        risk_level: pageData.risk_level
    };
    
    // Show loading state
    document.getElementById('submitCommentBtn').disabled = true;
    document.getElementById('submitCommentBtn').innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>提交中...';
    
    // Submit feedback via AJAX
    fetch('/api/feedback', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(feedbackData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Show success message
            document.getElementById('feedbackMessage').textContent = data.message;
            document.getElementById('feedbackSuccess').style.display = 'block';
            document.getElementById('feedbackError').style.display = 'none';
            
            // Hide comment section and buttons
            document.getElementById('commentSection').style.display = 'none';
            document.getElementById('thumbsUpBtn').style.display = 'none';
            document.getElementById('thumbsDownBtn').style.display = 'none';
            
            // Show a thank you message
            setTimeout(() => {
                document.getElementById('feedbackSection').innerHTML = `
                    <div class="text-center py-3 feedback-thank-you">
                        <i class="fas fa-heart text-danger fa-2x mb-2"></i>
                        <h5 class="text-success">感謝您的寶貴回饋！</h5>
                        <p class="text-muted mb-0">您的意見幫助我們改進計算結果的準確性。</p>
                    </div>
                `;
            }, 2000);
        } else {
            // Show error message
            document.getElementById('feedbackError').style.display = 'block';
            document.getElementById('feedbackSuccess').style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Error submitting feedback:', error);
        document.getElementById('feedbackError').style.display = 'block';
        document.getElementById('feedbackSuccess').style.display = 'none';
    })
    .finally(() => {
        // Reset button state
        document.getElementById('submitCommentBtn').disabled = false;
        document.getElementById('submitCommentBtn').innerHTML = '<i class="fas fa-paper-plane mr-1"></i>提交回饋';
    });
}

// Cancel feedback
function cancelFeedback() {
    // Hide comment section
    document.getElementById('commentSection').style.display = 'none';
    
    // Reset button states
    document.getElementById('thumbsUpBtn').disabled = false;
    document.getElementById('thumbsDownBtn').disabled = false;
    
    // Reset button classes
    document.getElementById('thumbsUpBtn').classList.remove('btn-success');
    document.getElementById('thumbsUpBtn').classList.add('btn-outline-success');
    document.getElementById('thumbsDownBtn').classList.remove('btn-danger');
    document.getElementById('thumbsDownBtn').classList.add('btn-outline-danger');
    
    // Clear comment
    document.getElementById('feedbackComment').value = '';
    
    // Reset feedback type
    currentFeedbackType = null;
}
</script>
{% endblock %}

<!-- Custom CSS for Enhanced PRECISE-DAPT Styling -->
<style>
    /* Enhanced styling for high bleeding risk alert */
    .alert-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
        border: 2px solid #bd2130 !important;
        color: white !important;
        font-weight: 500;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3) !important;
    }
    
    .alert-danger .alert-heading {
        color: white !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    .alert-danger .fas {
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    /* Enhanced warning styling for moderate risk */
    .alert-warning {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
        border: 2px solid #d39e00 !important;
        color: #212529 !important;
        font-weight: 500;
        box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3) !important;
    }
    
    /* Enhanced info styling for low risk */
    .alert-info {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
        border: 2px solid #117a8b !important;
        color: white !important;
        font-weight: 500;
        box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3) !important;
    }
    
    .alert-info .alert-heading {
        color: white !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Enhanced success styling for very low risk */
    .alert-success {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
        border: 2px solid #1c7430 !important;
        color: white !important;
        font-weight: 500;
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3) !important;
    }
    
    .alert-success .alert-heading {
        color: white !important;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Badge styling enhancements */
    .badge-lg {
        font-size: 1rem;
        padding: 0.5rem 1rem;
    }
    
    .badge-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
    }
    
    .badge-warning {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
        box-shadow: 0 2px 4px rgba(255, 193, 7, 0.3);
    }
    
    .badge-info {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
        box-shadow: 0 2px 4px rgba(23, 162, 184, 0.3);
    }
    
    .badge-success {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
    }
    
    /* Table enhancements */
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .table-warning {
        background-color: #fff3cd !important;
    }
    
    /* PRECISE-DAPT specific styling */
    .card-header.bg-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
    }
    
    .card-header.bg-success {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
    }
    
    .card-header.bg-info {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
    }
    
    /* Feedback Section Styling */
    .card-header.bg-light {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
        border-bottom: 2px solid #dee2e6;
    }
    
    #thumbsUpBtn:hover, #thumbsDownBtn:hover {
        transform: scale(1.05);
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    #thumbsUpBtn.btn-success {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        border-color: #1c7430;
        animation: successPulse 0.6s ease-in-out;
    }
    
    #thumbsDownBtn.btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        border-color: #bd2130;
        animation: dangerPulse 0.6s ease-in-out;
    }
    
    @keyframes successPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    @keyframes dangerPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    .feedback-thank-you {
        animation: fadeInUp 0.5s ease-in-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
